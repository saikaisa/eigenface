# 特征脸识别（Eigenface）



# 简介

**特征脸（Eigenfaces）**是一种经典的人脸识别方法，其主要思想是通过将人脸图像集合转化为一个低维特征空间，然后利用这些特征向量来表示和比较人脸。

在这个程序中，我使用了耶鲁大学的 Yale B 人脸数据库，这个数据库中包含了 38 个人的人脸，每个人脸在不同的光照下进行了大量采集，并包含表情变化。



# 程序说明

## 程序功能

这个程序主要有 3 个流程：

1. 读取图片（分别整理为训练集和测试集）。
2. 使用训练集提取出特征脸。
3. 使用测试集在训练的结果上进行测试，并计算正确率。

Yale B 人脸数据集中，有编号为 yaleB01~yaleB39（无 yaleB14）一共 38 个人的目录，我从每个人选取出 5 个脸作为训练集（一共 38 * 5 = 190 个），选取 2 个脸作为测试集（一共 38 * 2 = 76 个）

经实验，发现特征脸法的人脸识别能力对光照要求十分苛刻，在光照均匀时能达到 60% 以上的识别率，但是一旦出现偏光或者有不对称阴影，准确率会大幅下降，多降至 10%~50% 之间。

因此，我筛选出了光线比较均匀的几组人脸进行训练和测试，理想准确率在 50% 以上。

|       选取的训练集       |       选取的测试集       |
| :----------------------: | :----------------------: |
| yaleBxx_P00A+025E+00.pgm | yaleBxx_P00A+000E+00.pgm |
| yaleBxx_P00A+005E+10.pgm | yaleBxx_P00A+010E+00.pgm |
| yaleBxx_P00A-005E-10.pgm |                          |
| yaleBxx_P00A-010E-20.pgm |                          |
| yaleBxx_P00A-020E-10.pgm |                          |



## 参数

本程序由于需要进行大量的调试，所以可以快捷地修改参数。

### 1. 图片引用

- 图片目录：`data_path`

- 图片名称和数量：需要获取的图片名称分别保存在 `train_img_ref`，`test_img_ref` 所指向的文件中

  > 文件内存储的是图片名称后缀。因为每个人的目录内这些后缀都相同，只有前缀（人的编号）不同，所以通过选取这些后缀，就可以在每个人的目录内，选取出相同表情和光线的人脸。

- 图片尺寸：`image_size`

- 每个人的人脸数量：数量需要分别与 `train_img_ref` 和 `test_img_ref` 中列出的图片行数相同

  - `train_img_per_person`：每个人的待训练人脸数量
  - `test_img_per_person`：每个人的待测试人脸数量




**训练集和测试集均可以自定义为目录中其他的人脸。**

**修改步骤如下：**

1. 仿照 TestImage.txt 和 TrainImage.txt 中的格式，修改这两个文件。
2. 修改 `train_img_per_person` 与 `test_img_per_person` 参数，需要分别与 TestImage.txt 和 TrainImage.txt 的图片名数量相同。



### 2. 特征向量选取（通过特征值占比）

可以通过调整 `ratio` 参数（范围 0~1）来改变特征向量（特征脸）选取的数量，经测试，0.85~0.93 之间最佳。0.85 之前，识别率过低；0.93 之后，识别率有略微下降趋势，且产生太多特征脸影响性能。

在本程序和所选数据集的前提下，0.92 为识别率最高的值，达到了 69.737%，接近 70%。



## 运行结果

程序运行完成后，会输出如下内容：

1. **pyplot 输出**

   - 一张平均脸图像
   - 一批特征脸图像

   <img src="https://static.saikaisa.top:443/img/image-20231213155759039_repeat_1702454355568__959411.png" alt="平均脸" style="zoom: 50%;" />

   <img src="https://static.saikaisa.top:443/img/image-20231213155824215_repeat_1702454349138__629664.png" alt="特征脸"  />

2. **控制台输出**

   - 图片读取状态（如果有图片无法读取会给出相应的错误路径输出）
   - 特征脸计算状态：显示最终的特征脸数量
   - 测试脸预测状态：给出当前测试脸实际对应的人物编号，以及预测出的最贴近的人物编号
   - 识别正确率

控制台输出如下：

```
C:\Users\Saikai\AppData\Local\Programs\Python\Python311\python.exe D:\CodeProjects\pythonProject\eigenface\tmp.py 
=================================================
Loading images...
Load successfully.
=================================================
Calculating eigenfaces...
Calculated successfully.
特征脸 (eigenface) 数量：32
=================================================
Predicting...
第 01 张测试脸（来自 01 号）最贴近的人是：36 号
第 02 张测试脸（来自 01 号）最贴近的人是：01 号
第 03 张测试脸（来自 02 号）最贴近的人是：02 号
第 04 张测试脸（来自 02 号）最贴近的人是：02 号
第 05 张测试脸（来自 03 号）最贴近的人是：03 号
第 06 张测试脸（来自 03 号）最贴近的人是：10 号
第 07 张测试脸（来自 04 号）最贴近的人是：04 号
第 08 张测试脸（来自 04 号）最贴近的人是：04 号
第 09 张测试脸（来自 05 号）最贴近的人是：05 号
第 10 张测试脸（来自 05 号）最贴近的人是：35 号
第 11 张测试脸（来自 06 号）最贴近的人是：06 号
第 12 张测试脸（来自 06 号）最贴近的人是：06 号
第 13 张测试脸（来自 07 号）最贴近的人是：04 号
第 14 张测试脸（来自 07 号）最贴近的人是：07 号
第 15 张测试脸（来自 08 号）最贴近的人是：08 号
第 16 张测试脸（来自 08 号）最贴近的人是：19 号
第 17 张测试脸（来自 09 号）最贴近的人是：08 号
第 18 张测试脸（来自 09 号）最贴近的人是：09 号
第 19 张测试脸（来自 10 号）最贴近的人是：10 号
第 20 张测试脸（来自 10 号）最贴近的人是：10 号
第 21 张测试脸（来自 11 号）最贴近的人是：19 号
第 22 张测试脸（来自 11 号）最贴近的人是：11 号
第 23 张测试脸（来自 12 号）最贴近的人是：12 号
第 24 张测试脸（来自 12 号）最贴近的人是：12 号
第 25 张测试脸（来自 13 号）最贴近的人是：13 号
第 26 张测试脸（来自 13 号）最贴近的人是：13 号
第 27 张测试脸（来自 14 号）最贴近的人是：14 号
第 28 张测试脸（来自 14 号）最贴近的人是：14 号
第 29 张测试脸（来自 15 号）最贴近的人是：27 号
第 30 张测试脸（来自 15 号）最贴近的人是：10 号
第 31 张测试脸（来自 16 号）最贴近的人是：16 号
第 32 张测试脸（来自 16 号）最贴近的人是：16 号
第 33 张测试脸（来自 17 号）最贴近的人是：17 号
第 34 张测试脸（来自 17 号）最贴近的人是：17 号
第 35 张测试脸（来自 18 号）最贴近的人是：07 号
第 36 张测试脸（来自 18 号）最贴近的人是：18 号
第 37 张测试脸（来自 19 号）最贴近的人是：07 号
第 38 张测试脸（来自 19 号）最贴近的人是：19 号
第 39 张测试脸（来自 20 号）最贴近的人是：20 号
第 40 张测试脸（来自 20 号）最贴近的人是：20 号
第 41 张测试脸（来自 21 号）最贴近的人是：21 号
第 42 张测试脸（来自 21 号）最贴近的人是：01 号
第 43 张测试脸（来自 22 号）最贴近的人是：22 号
第 44 张测试脸（来自 22 号）最贴近的人是：15 号
第 45 张测试脸（来自 23 号）最贴近的人是：23 号
第 46 张测试脸（来自 23 号）最贴近的人是：23 号
第 47 张测试脸（来自 24 号）最贴近的人是：19 号
第 48 张测试脸（来自 24 号）最贴近的人是：24 号
第 49 张测试脸（来自 25 号）最贴近的人是：16 号
第 50 张测试脸（来自 25 号）最贴近的人是：25 号
第 51 张测试脸（来自 26 号）最贴近的人是：27 号
第 52 张测试脸（来自 26 号）最贴近的人是：15 号
第 53 张测试脸（来自 27 号）最贴近的人是：27 号
第 54 张测试脸（来自 27 号）最贴近的人是：27 号
第 55 张测试脸（来自 28 号）最贴近的人是：28 号
第 56 张测试脸（来自 28 号）最贴近的人是：28 号
第 57 张测试脸（来自 29 号）最贴近的人是：04 号
第 58 张测试脸（来自 29 号）最贴近的人是：29 号
第 59 张测试脸（来自 30 号）最贴近的人是：29 号
第 60 张测试脸（来自 30 号）最贴近的人是：07 号
第 61 张测试脸（来自 31 号）最贴近的人是：31 号
第 62 张测试脸（来自 31 号）最贴近的人是：31 号
第 63 张测试脸（来自 32 号）最贴近的人是：32 号
第 64 张测试脸（来自 32 号）最贴近的人是：32 号
第 65 张测试脸（来自 33 号）最贴近的人是：33 号
第 66 张测试脸（来自 33 号）最贴近的人是：35 号
第 67 张测试脸（来自 34 号）最贴近的人是：34 号
第 68 张测试脸（来自 34 号）最贴近的人是：11 号
第 69 张测试脸（来自 35 号）最贴近的人是：35 号
第 70 张测试脸（来自 35 号）最贴近的人是：35 号
第 71 张测试脸（来自 36 号）最贴近的人是：36 号
第 72 张测试脸（来自 36 号）最贴近的人是：36 号
第 73 张测试脸（来自 37 号）最贴近的人是：37 号
第 74 张测试脸（来自 37 号）最贴近的人是：37 号
第 75 张测试脸（来自 38 号）最贴近的人是：30 号
第 76 张测试脸（来自 38 号）最贴近的人是：38 号
Prediction finished.
正确率：69.737%
=================================================

Process finished with exit code 0
```

